{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\FBInstantGames.js"],"names":["cc","Class","extends","Component","properties","avatar","Sprite","nick_name","Label","id","info","log","pointTip","point","userid","start","self","FBInstant","ShowLog","player","getID","string","getName","photoUrl","getPhoto","loader","load","err","texture","spriteFrame","SpriteFrame","contextID","context","contextType","getType","locale","getLocale","platform","getPlatform","sdkVersion","getSDKVersion","onQuitGame","quit","onShareGame","shareAsync","intent","image","getImgBase64","text","data","myReplayData","then","onChooseAsyncTest","chooseAsync","updateAsync","action","cta","default","localizations","ar_AR","en_US","es_LA","template","strategy","notification","catch","reason","code","message","onInterstitialAdTest","ad","getInterstitialAdAsync","interstitial","getPlacementID","loadAsync","showAsync","onRewardedVideoTest","preloadedInterstitial","getRewardedVideoAsync","onLeaderboardCountTest","leaderboardID","getLeaderboardID","getLeaderboardAsync","leaderboard","getEntryCountAsync","count","name","console","onGetAllScoreTest","getEntriesAsync","entries","i","length","getRank","getPlayer","getScore","onGetPlayerScoreTest","getPlayerEntryAsync","entry","onSetPlayerScoreTest","score","setScoreAsync","getExtraData","onGetConnectedPlayersTest","getConnectedPlayerEntriesAsync","onSetSessionDataTest","setSessionData","myScore","onJSGetFriendListTest","FB","api","response","error","sp","find","getComponent","target","width","height","renderTexture","RenderTexture","begin","_sgNode","visit","end","canvas","document","createElement","ctx","getContext","_renderType","game","RENDER_TYPE_CANVAS","getSprite","getTexture","getHtmlElementObj","drawImage","RENDER_TYPE_WEBGL","buffer","gl","createFramebuffer","bindFramebuffer","FRAMEBUFFER","_glID","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","Uint8Array","readPixels","RGBA","UNSIGNED_BYTE","rowBytes","row","srow","data2","Uint8ClampedArray","imageData","ImageData","putImageData","toDataURL","getPointTest","value","oldLog","onLeaderboardUpdate"],"mappings":"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","file":"FBInstantGames.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Facebook 官方 API 传送门：https://developers.facebook.com/docs/games/instant-games/sdk\n// 使用 Instant Games API 自定义组件（通常用户会自己自身需求去使用 API）\n// 目前这里只是用了以下基础 API\n// 玩家信息\n// 1. FBInstant.player.getName\n// 2. FBInstant.player.getID\n// 3. FBInstant.player.getPhoto\n// 其他信息\n// 1. FBInstant.context.getID\n// 2. FBInstant.context.getType\n// 3. FBInstant.getLocale\n// 4. FBInstant.getPlatform\n// 4. FBInstant.getSDKVersion\n// 退出，分享功能\n// 1. FBInstant.quit\n// 2. FBInstant.shareAsync\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        avatar: cc.Sprite,      // 头像\n        nick_name: cc.Label,    // 昵称\n        id: cc.Label,           // ID\n        info: cc.Label,         // 其他信息\n        log: cc.Label,          //LOG内容 \n        pointTip: cc.Label,     //分数提示\n    },\n\n    point: 0,           //分数\n    userid : '',\n    start () {\n\n        this.point = 0;\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }      \n\n        // 显示玩家信息\n        this.userid = FBInstant.player.getID();\n\n        // 设置昵称\n        this.nick_name.string = 'Name:' + FBInstant.player.getName();\n        // 设置 ID\n        this.id.string = 'ID:' + FBInstant.player.getID();\n        // 设置头像\n        var photoUrl = FBInstant.player.getPhoto();\n        cc.loader.load(photoUrl, (err, texture) => {\n            this.avatar.spriteFrame = new cc.SpriteFrame(texture);\n        });\n        // 设置其他信息\n        var info = {\n            contextID: FBInstant.context.getID(), // 游戏 ID\n            contextType: FBInstant.context.getType(), // 游戏类型\n            locale: FBInstant.getLocale(),  // 地区\n            platform: FBInstant.getPlatform(),// 平台\n            sdkVersion: FBInstant.getSDKVersion(),// SDK 版本号\n        }\n        this.info.string = 'Context ID: ' + info.contextID + '\\n' +\n                           'Context Type: ' + info.contextType + '\\n' +\n                           'Locale: ' + info.locale + '\\n' +\n                           'Platform: ' + info.platform + '\\n' +\n                           'SDKVersion: ' + info.sdkVersion;\n\n    },\n\n    // 退出游戏\n    onQuitGame () {\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }\n\n        FBInstant.quit();\n    },\n\n    // 分享功能\n    onShareGame () {\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }\n        \n        FBInstant.shareAsync({\n            intent: 'SHARE',\n            image: this.getImgBase64(),\n            text: 'X is asking for your help!',\n            data: {myReplayData: '...'},\n        }).then(() => {\n            // continue with the game.\n            self.ShowLog(\"share successed\");\n        });\n    },\n    //choose功能\n    onChooseAsyncTest () {\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }\n\n        FBInstant.context.chooseAsync().then(() => {\n            // continue with the game.\n            self.ShowLog(FBInstant.context.getID());\n            FBInstant.updateAsync({\n                action: 'CUSTOM',\n                cta: 'Join The Fight',\n                image: this.getImgBase64(),\n                text: {\n                    default: 'X just invaded Y\\'s village!',\n                    localizations: {\n                    ar_AR: 'X \\u0641\\u0642\\u0637 \\u063A\\u0632\\u062A ' +\n                    '\\u0642\\u0631\\u064A\\u0629 Y!',\n                    en_US: 'X just invaded Y\\'s village!',\n                    es_LA: '\\u00A1X acaba de invadir el pueblo de Y!',\n                    }\n                },\n                template: 'VILLAGE_INVASION',\n                data: { myReplayData: '...' },\n                strategy: 'IMMEDIATE',\n                notification: 'NO_PUSH',\n            }).then(function() {\n                self.ShowLog(\"update test succeed!\")\n            }).catch((reason)=>{\n                self.ShowLog(\"update failed. CODE:\" + reason.code + \" Message:\" + reason.message);\n            });;\n        }).catch((reason)=>{\n            self.ShowLog(\"choose failed. CODE:\" + reason.code + \" Message:\" + reason.message);\n        });\n    },\n    //Interstitial Ad测试\n    onInterstitialAdTest () {\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }\n        \n        var ad = null;\n\n        FBInstant.getInterstitialAdAsync(\n            '1825071287585077_1841418182617054', // Your Ad Placement Id\n        ).then(function(interstitial) {\n            // Load the Ad asynchronously\n            ad = interstitial;\n            self.ShowLog('placementId:'+ad.getPlacementID());\n            return ad.loadAsync();\n        }).then(function() {\n            self.ShowLog('Interstitial ad preloaded');\n            return ad.showAsync();\n        }).then(function(){\n            self.ShowLog('Interstitial ad show');\n        }).catch(function(reason){\n            self.ShowLog(\"Interstitial ad failed. CODE:\" + reason.code + \" Message:\" + reason.message);\n        });\n        \n    },\n    //Rewarded Video测试\n    onRewardedVideoTest () {\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }\n        \n        var preloadedInterstitial = null;\n\n        FBInstant.getRewardedVideoAsync(\n            '1825071287585077_1841418182617054', // Your Ad Placement Id\n        ).then(function(interstitial) {\n        // Load the Ad asynchronously\n            preloadedInterstitial = interstitial;\n            self.ShowLog('placementId:'+preloadedInterstitial.getPlacementID());\n            return preloadedInterstitial.loadAsync();\n        }).then(function() {\n            self.ShowLog('Rewarded Video preloaded');\n            return preloadedInterstitial.showAsync();\n        }).then(function(){\n            self.ShowLog('Rewarded Video show');\n        }).catch(function(reason){\n            self.ShowLog(\"Rewarded Video failed. CODE:\" + reason.code + \" Message:\" + reason.message);\n        });\n    },\n    //获取排行榜\n    onLeaderboardCountTest(){\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }\n        var leaderboardID = this.getLeaderboardID();\n        FBInstant.getLeaderboardAsync(\n            leaderboardID\n        ).then(function(leaderboard) {\n             return leaderboard.getEntryCountAsync();\n        }).then(function(count) {\n            self.ShowLog(\"Leaderboard Count: \"+ count);\n            //update更新，因为回调的this不指向这个脚本，因此重写一遍\n            return FBInstant.updateAsync({\n            action: 'LEADERBOARD',\n            name: leaderboardID\n            });\n        }).then(function() { \n            console.log('Update Posted');\n        }).catch(function(reason){\n            self.ShowLog(\"Get Leaderboard count failed. CODE:\" + reason.code + \" Message:\" + reason.message);\n        });\n    },\n    //获取排行榜上所有的分数\n    onGetAllScoreTest(){\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }\n        var leaderboardID = this.getLeaderboardID();\n        FBInstant.getLeaderboardAsync(\n            leaderboardID\n        ).then(function(leaderboard) {\n            return leaderboard.getEntriesAsync();\n        }).then(function(entries) {\n            for (var i = 0; i < entries.length; i++) {\n                var log = entries[i].getRank() + '. ' +\n                entries[i].getPlayer().getName() + ': ' +\n                entries[i].getScore();\n\n                self.ShowLog(log);\n            }\n\n             //update更新，因为回调的this不指向这个脚本，因此重写一遍\n             return FBInstant.updateAsync({\n                action: 'LEADERBOARD',\n                name: leaderboardID\n              });\n        }).then(function() { \n            console.log('Update Posted');\n        }).catch(function(reason){\n            self.ShowLog(\"Get all score failed. CODE:\" + reason.code + \" Message:\" + reason.message);\n        });\n    },\n    //获取排行榜上自己的分数\n    onGetPlayerScoreTest(){\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }\n        var leaderboardID = this.getLeaderboardID();\n\n        FBInstant.getLeaderboardAsync(\n            leaderboardID\n        ).then(function(leaderboard) {\n          return leaderboard.getPlayerEntryAsync();\n        }).then(function(entry) {\n            var log = entry.getRank() + '. ' +\n            entry.getPlayer().getName() + ': ' +\n            entry.getScore();\n\n            self.ShowLog(log);\n\n         //update更新，因为回调的this不指向这个脚本，因此重写一遍\n         return FBInstant.updateAsync({\n            action: 'LEADERBOARD',\n            name: leaderboardID\n          });\n    }).then(function() { \n        console.log('Update Posted');\n    }).catch(function(reason){\n            self.ShowLog(\"Get player score failed. CODE:\" + reason.code + \" Message:\" + reason.message);\n        });\n      \n    },\n    //向排行榜上传自己的分数\n    onSetPlayerScoreTest(){\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }\n        var score = this.point;\n        var leaderboardID = this.getLeaderboardID();\n        FBInstant.getLeaderboardAsync(\n            leaderboardID\n        ).then(function(leaderboard) {\n            return leaderboard.setScoreAsync(score, '{race: \"elf\", level: 3}');\n        }).then(function(entry) {\n            self.ShowLog(entry.getScore());\n            self.ShowLog(entry.getExtraData());\n            \n            //update更新，因为回调的this不指向这个脚本，因此重写一遍\n            return FBInstant.updateAsync({\n                action: 'LEADERBOARD',\n                name: leaderboardID\n            });\n        }).then(function() { \n            console.log('Update Posted');\n        }).catch(function(reason){\n            self.ShowLog(\"Set player score failed. CODE:\" + reason.code + \" Message:\" + reason.message);\n        });\n    },\n    onGetConnectedPlayersTest(){\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }\n        var score = this.point;\n        var leaderboardID = this.getLeaderboardID();\n        FBInstant.getLeaderboardAsync(\n            leaderboardID\n        ).then(function(leaderboard) {\n            return leaderboard.getConnectedPlayerEntriesAsync();\n        }).then(function(entries) {\n            for (var i = 0; i < entries.length; i++) {\n                var log = entries[i].getRank() + '. ' +\n                entries[i].getPlayer().getName() + ': ' +\n                entries[i].getScore();\n                \n                self.ShowLog(log);\n            }\n            //update更新，因为回调的this不指向这个脚本，因此重写一遍\n            return FBInstant.updateAsync({\n                action: 'LEADERBOARD',\n                name: leaderboardID\n            });\n        }).then(function() { \n            console.log('Update Posted');\n        }).catch(function(reason){\n            self.ShowLog(\"Get connected players failed. CODE:\" + reason.code + \" Message:\" + reason.message);\n        });\n    },\n    onSetSessionDataTest(){\n        var self = this;\n        if (typeof FBInstant === 'undefined'){\n            self.ShowLog('no sdk');\n            return;\n        }\n        \n        if(FBInstant.context.getID()){\n            FBInstant.setSessionData({myScore : this.point});\n        }else{\n            self.ShowLog('current context id is null');\n        }\n    },\n    //jssdk graph api friend list\n    onJSGetFriendListTest(){\n        var self = this;\n        if (typeof FB === 'undefined'){\n            self.ShowLog('no jssdk');\n            return;\n        }\n\n        // access token\n        // FB.getLoginStatus(function(response) {\n        //     if (response.status === 'connected') {\n        //         var accessToken = response.authResponse.accessToken;\n\n        //     } \n        // });\n\n        /* make the API call */\n        FB.api(\n            \"/\"+this.userid+\"/friends\",\n            function (response) {\n                if (response && !response.error) {\n                    /* handle the result */\n                    console.log(\"find user data\");\n                }\n                if(response.error){\n                    console.log(\"get user data failed. CODE:\" + response.error.code + \" Message:\" + response.error.message);\n                }\n            }\n        );\n\n    },\n    // 截屏返回 iamge base6，用于 Share\n    getImgBase64 () {\n        let sp = cc.find('Canvas/New Sprite(Splash)').getComponent(cc.Sprite);\n\n        let target = cc.find('Canvas');\n        let width = 960, height = 640;\n        let renderTexture = new cc.RenderTexture(width, height);\n        renderTexture.begin();\n        target._sgNode.visit();\n        renderTexture.end();\n        //\n        let canvas = document.createElement('canvas');\n        let ctx = canvas.getContext('2d');\n        canvas.width = width;\n        canvas.height = height;\n        if (cc._renderType === cc.game.RENDER_TYPE_CANVAS) {\n            let texture = renderTexture.getSprite().getTexture();\n            let image = texture.getHtmlElementObj();\n            ctx.drawImage(image, 0, 0);\n        }\n        else if (cc._renderType === cc.game.RENDER_TYPE_WEBGL) {\n            let buffer = gl.createFramebuffer();\n            gl.bindFramebuffer(gl.FRAMEBUFFER, buffer);\n            let texture = renderTexture.getSprite().getTexture()._glID;\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n            let data = new Uint8Array(width * height * 4);\n            gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, data);\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n            let rowBytes = width * 4;\n            for (let row = 0; row < height; row++) {\n                let srow = height - 1 - row;\n                let data2 = new Uint8ClampedArray(data.buffer, srow * width * 4, rowBytes);\n                let imageData = new ImageData(data2, width, 1);\n                ctx.putImageData(imageData, 0, row);\n            }\n        }\n        return canvas.toDataURL('image/png');\n    },\n\n    getPointTest(){\n        this.point += 1;\n        this.pointTip.string = \"当前分数是：\" + this.point;\n    },\n    ShowLog(value){\n        // var date = new Date();\n        var oldLog = this.log.string;\n        this.log.string = /* date.getTime() + \" \" + */ value + \"\\n\" + oldLog;\n    },\n    onLeaderboardUpdate(){\n        var self = this;\n        FBInstant.updateAsync({\n            action: 'LEADERBOARD',\n            name: this.getLeaderboardID()\n          }).then(() => console.log('Update Posted')).catch(error => console.error(error));\n    },\n    getLeaderboardID(){\n        if(FBInstant.context.getID()){\n            return '51 Test Leaderboards.' + FBInstant.context.getID();\n        }else{\n            return '51 Global Leaderboard 1';\n            // return '51 Test Leaderboards.1612523208877149';\n        }\n\n    }\n});\n"]}